---
title: "Analysis Comparative Genomic Analysis of Endometriosis-Associated vs Non-Associated "
format: html
---

# Analysis 3 - Comparative Genomic Analysis of Endometriosis-Associated vs Non-Associated MAGs

In this analysis, we compare basic genomic features of MAGs from genera previously linked to endometriosis against all other vaginal MAGs. We focus on GC content, genome length, and assembly quality (completeness and contamination) to assess whether endometriosis-associated genera form a genomically distinct subgroup.

Are endometriosis-associated MAGs genomically distinct?

## 1. Load libraries

```{r}
#| message: false
#| warning: false
library("tidyverse")
```

## 2. Load data

```{r}
genome_metadata_aug <- readr::read_tsv("../data/03_dat_aug.tsv")
```

## 3. Phylum-level distribution of associated vs non-associated MAGs

Before comparing genomic features between endometriosis-associated and non-associated MAGs, it is important to understand whether the two groups are taxonomically comparable. GC content, genome size, and other genomic traits are strongly influenced by phylogeny, especially at the phylum level. If associated MAGs occur primarily within a few dominant phyla, any genomic differences reflect underlying phylogenetic structure rather than the biological effect of endometriosis association. A phylum-level analysis therefore provides essential context for interpreting all downstream genomic comparisons.

### 3.1 Distribution of MAGs by phylum and association status

The plot shows how many MAGs occur in each phylum and whether the two groups (associated vs non-associated) are taxonomically balanced.

```{r}

phylum_prop_plot <-
  genome_metadata_aug |>
    count(Phylum, endometriosis_associated) |>
    group_by(Phylum) |>
    mutate(prop = n / sum(n)) |>
    ggplot(aes(x = Phylum,
               y = prop,
               fill = endometriosis_associated)) +
    geom_col(width = 0.7) +
    scale_fill_brewer(palette = "Set1") +
    labs(
      title = "Proportion of endometriosis-associated MAGs within each phylum",
      x = "Phylum",
      y = "Proportion",
      fill = "Associated"
    ) +
    theme_minimal(base_size = 13) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Saving plot
ggsave(filename = "../results/analysis3_phylum_proportion.png",
       plot = phylum_prop_plot,
       width = 120,
       height = 90,
       units = "mm")


```

Several phyla contain both “Yes” and “No” MAGs because endometriosis association is defined at the genus level, not the phylum level. Large vaginal phyla such as *Actinomycetota*, *Bacillota* and *Bacteroidota* include many different genera. As a result, these dominant phyla contain mostly non-associated MAGs, along with a smaller number of associated ones. This pattern is expected and reflects the natural structure of the vaginal microbiome rather than a phylum-wide association with the disease.

### 3.2 Test for taxonomic enrichment

We next test whether the distribution of associated vs non-associated MAGs across phyla differs from what would be expected by chance.

```{r}
phylum_table <- table(
  genome_metadata_aug$Phylum,
  genome_metadata_aug$endometriosis_associated
)

phylum_table

chisq.test(phylum_table)

```

The chi-square test shows a significant deviation from independence (p ≈ 8.5 × 10⁻⁵), meaning that the distribution of associated vs non-associated MAGs is not random across phyla. This result is fully expected, because only a few genera within *Actinomycetota* and *Bacillota* are annotated as endometriosis-associated, while other phyla contain no associated genera at all. The warning about the approximation occurs because several phyla contain very small counts (zeros), which is normal in microbiome datasets and does not change the biological interpretation.

### 3.3 GC content within phyla

To check whether GC differences between associated and non-associated MAGs are influenced by phylum-level structure, we compare GC content within each phylum.

```{r}
# Create plot
phylum_prop_plot <-
  genome_metadata_aug |>
    count(Phylum, endometriosis_associated) |>
    group_by(Phylum) |>
    mutate(prop = n / sum(n)) |>
    ggplot(aes(x = Phylum,
               y = prop,
               fill = endometriosis_associated)) +
    geom_col(width = 0.7) +
    scale_fill_brewer(palette = "Set1") +
    labs(
      title = "Proportion of endometriosis-associated MAGs within each phylum",
      x = "Phylum",
      y = "Proportion",
      fill = "Associated"
    ) +
    theme_minimal(base_size = 13) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Saving the plot 
ggsave(filename = "../results/analysis3_phylum_proportion.png",
       plot = phylum_prop_plot,
       width = 120,
       height = 90,
       units = "mm")


```

The faceted boxplots show that within each phylum, GC-content values are very similar between associated and non-associated MAGs. The only phyla that contain both groups (Actinomycetota and Bacillota) show overlapping GC distributions with no clear separation. All other phyla contain only non-associated MAGs. This confirms that any GC differences observed at the whole-dataset level are driven by phylogenetic structure, not by endometriosis association.

Together, these results indicate that endometriosis-associated MAGs are a taxonomically restricted subset of the broader vaginal microbiome, and their genomic features are typical for their phyla. There is no evidence that endometriosis-associated genera form a genomically distinct lineage when accounting for taxonomy.

## 4. GC content of endometriosis-associated genera

We first compare the GC-content distributions between MAGs belonging to endometriosis-associated genera and those not linked to endometriosis. GC content can reflect long-term evolutionary pressures, so any systematic shift between the two groups could indicate deeper genomic differences.

```{r}
# Create plot
gc_violin_plot <-
  genome_metadata_aug |>
    ggplot(aes(x = endometriosis_associated,
               y = GC_content,
               fill = endometriosis_associated)) +
    geom_violin(trim = FALSE, alpha = 0.5) +
    geom_boxplot(width = 0.18,
                 outlier.size = 0.7,
                 alpha = 0.9,
                 colour = "black") +
    scale_fill_brewer(palette = "Set2") +
    labs(
      x = "Endometriosis-associated genus",
      y = "GC content (%)",
      title = "GC content distributions by endometriosis association"
    ) +
    theme_minimal(base_size = 13) +
    theme(legend.position = "none")

# Saving the plot
ggsave(filename = "../results/analysis3_gc_violin.png",
       plot = gc_violin_plot,
       width = 120,
       height = 90,
       units = "mm")


```

The distributions show substantial overlap between the groups. Endometriosis-associated MAGs have a slightly lower median GC content, but the difference is modest and the overall ranges are similar. This indicates that GC composition does not clearly distinguish taxa associated with endometriosis. GC-content distributions are nearly identical, indicating no genomic differences between endometriosis-associated and non-associated MAGs.

## 5. Genome length comparison

Next, we test whether genome size relates differently to GC content in endometriosis-associated genera. If differences existed in evolutionary strategies—such as genome reduction or expansion—they might appear as distinct clustering patterns.

```{r}
genome_metadata_aug |>
  ggplot(aes(x      = GC_content,
             y      = Length,
             colour = endometriosis_associated)) +
  geom_point(alpha = 0.6,
             size  = 2) +
  scale_y_log10() +
  scale_colour_brewer(palette = "Set1") +
  labs(
    x      = "GC content (%)",
    y      = "Genome length (bp, log scale)",
    title  = "GC content vs genome length by endometriosis association",
    colour = "Associated"
  ) +
  theme_minimal(base_size = 13)



```

The scatterplot shows that MAGs from both groups occupy similar GC–length space. No association-specific cluster is visible, and both groups span comparable genome sizes across the GC spectrum. This suggests that genome size and GC composition are not meaningfully structured by endometriosis association.

## 6. Completeness and contamination

Finally, we investigate whether endometriosis-associated genera differ in technical assembly quality. Completeness and contamination reflect how well each genome was reconstructed and whether its quality differs systematically across groups.

```{r}

genome_metadata_aug |>
  select(endometriosis_associated,
         Completeness,
         Contamination) |>
  pivot_longer(
    cols      = c(Completeness, Contamination),
    names_to  = "metric",
    values_to = "value"
  ) |>
  ggplot(aes(x    = endometriosis_associated,
             y    = value,
             fill = endometriosis_associated)) +
  geom_violin(trim  = FALSE,
              alpha = 0.5) +
  geom_boxplot(width        = 0.17,
               outlier.size = 0.7,
               alpha        = 0.9) +
  facet_wrap(~ metric,
             scales = "free_y") +
  scale_fill_brewer(palette = "Set2") +
  labs(
    x     = "Endometriosis-associated genus",
    y     = "Value (%)",
    title = "MAG completeness and contamination by association status"
  ) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none")


```

Both completeness and contamination distributions are nearly identical between associated and non-associated genera. Completeness remains high (\>90%) in both groups, and contamination is consistently low. This confirms that assembly quality is comparable across MAGs and does not bias downstream comparisons between the groups.

Using genera previously linked to endometriosis in vaginal microbiome studies, we annotated a subset of MAGs and compared their genomic features to the rest of the dataset. Across GC content, genome size, completeness, and contamination, the two groups showed only minor differences with broad overlap. This indicates that endometriosis-associated genera do not form a genomically distinct group within the vaginal microbiome. Instead, their relevance to endometriosis likely reflects differences in abundance or community composition rather than major differences in genome architecture.

## **7. Conclusion**

This analysis describes a comparative genomic evaluation showing that taxa associated with endometriosis are not genetically unique but simply part of expected vaginal microbial diversity, and their association with the disease likely arises from ecological, not genomic, differences.

{
  "hash": "2a7cbbbfa8523965d7fa7d1850000afd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Clean dataset\"\nformat: html\n---\n\n\n\n# Clean Data\n\n## 1. Load libraries\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"tidyverse\")\n```\n:::\n\n\n\n## 2. Load data\n\nLoading the data saved in the 01_dat_load.tsv file\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenome_metadata <- readr::read_tsv(\"../data/01_dat_load.tsv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 618 Columns: 20\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (10): Genome, Genome_type, Genome_accession, Species_rep, Lineage, Sampl...\ndbl (10): Length, N_contigs, N50, GC_content, Completeness, Contamination, r...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n\n## 3. Data preparation\n\nUsing the `str` command to investigate, what the data looks like:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(genome_metadata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nspc_tbl_ [618 × 20] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ Genome          : chr [1:618] \"MGYG000303700\" \"MGYG000303701\" \"MGYG000303702\" \"MGYG000303703\" ...\n $ Genome_type     : chr [1:618] \"MAG\" \"MAG\" \"MAG\" \"MAG\" ...\n $ Length          : num [1:618] 678213 1500176 1210062 1706016 703182 ...\n $ N_contigs       : num [1:618] 2 18 44 27 7 112 185 90 12 57 ...\n $ N50             : num [1:618] 466332 112881 48790 89653 111709 ...\n $ GC_content      : num [1:618] 47.8 42.4 26.4 44.6 47.8 ...\n $ Completeness    : num [1:618] 63.7 87.8 94.8 93.7 63.7 ...\n $ Contamination   : num [1:618] 0 0 0.55 1.06 0 0.36 0.72 0.09 0 0.85 ...\n $ rRNA_5S         : num [1:618] 0 0 0 0 0 0 0 0 0 0 ...\n $ rRNA_16S        : num [1:618] 99.7 0 0 0 99.7 ...\n $ rRNA_23S        : num [1:618] 99.6 0 0 0 99.6 ...\n $ tRNAs           : num [1:618] 20 20 9 20 20 19 7 18 20 20 ...\n $ Genome_accession: chr [1:618] \"CAMPLK01\" \"CAMPLL01\" \"CAMPLM01\" \"CAMPLN01\" ...\n $ Species_rep     : chr [1:618] \"MGYG000303700\" \"MGYG000303918\" \"MGYG000303789\" \"MGYG000304079\" ...\n $ Lineage         : chr [1:618] \"d__Bacteria;p__Patescibacteria;c__Saccharimonadia;o__Saccharimonadales;f__Nanoperiomorbaceae;g__Nanoperiomorbus\"| __truncated__ \"d__Bacteria;p__Bacillota_A;c__Clostridia;o__Saccharofermentanales;f__Fastidiosipilaceae;g__KA00274;s__KA00274 sp902373515\" \"d__Bacteria;p__Bacillota;c__Bacilli;o__Staphylococcales;f__Gemellaceae;g__Gemella;s__Gemella asaccharolytica\" \"d__Bacteria;p__Bacillota_A;c__Clostridia;o__Saccharofermentanales;f__Fastidiosipilaceae;g__Mageeibacillus;s__Ma\"| __truncated__ ...\n $ Sample_accession: chr [1:618] \"SAMEA111346158\" \"SAMEA111346148\" \"SAMEA111346137\" \"SAMEA111346154\" ...\n $ Study_accession : chr [1:618] \"ERP138373\" \"ERP138373\" \"ERP138373\" \"ERP138373\" ...\n $ Country         : chr [1:618] \"not provided\" \"not provided\" \"not provided\" \"not provided\" ...\n $ Continent       : chr [1:618] \"not provided\" \"not provided\" \"not provided\" \"not provided\" ...\n $ FTP_download    : chr [1:618] \"ftp://ftp.ebi.ac.uk/pub/databases/metagenomics/mgnify_genomes/human-vaginal/v1.0/all_genomes/MGYG0003037/MGYG00\"| __truncated__ \"ftp://ftp.ebi.ac.uk/pub/databases/metagenomics/mgnify_genomes/human-vaginal/v1.0/all_genomes/MGYG0003039/MGYG00\"| __truncated__ \"ftp://ftp.ebi.ac.uk/pub/databases/metagenomics/mgnify_genomes/human-vaginal/v1.0/all_genomes/MGYG0003037/MGYG00\"| __truncated__ \"ftp://ftp.ebi.ac.uk/pub/databases/metagenomics/mgnify_genomes/human-vaginal/v1.0/all_genomes/MGYG0003040/MGYG00\"| __truncated__ ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   Genome = col_character(),\n  ..   Genome_type = col_character(),\n  ..   Length = col_double(),\n  ..   N_contigs = col_double(),\n  ..   N50 = col_double(),\n  ..   GC_content = col_double(),\n  ..   Completeness = col_double(),\n  ..   Contamination = col_double(),\n  ..   rRNA_5S = col_double(),\n  ..   rRNA_16S = col_double(),\n  ..   rRNA_23S = col_double(),\n  ..   tRNAs = col_double(),\n  ..   Genome_accession = col_character(),\n  ..   Species_rep = col_character(),\n  ..   Lineage = col_character(),\n  ..   Sample_accession = col_character(),\n  ..   Study_accession = col_character(),\n  ..   Country = col_character(),\n  ..   Continent = col_character(),\n  ..   FTP_download = col_character()\n  .. )\n - attr(*, \"problems\")=<externalptr> \n```\n\n\n:::\n:::\n\n\n\nThe data consist of a data-frame with 618 observations and 20 variables. We recognize that observations with no value found has the identifier \"not provided\". Additionally one variable contains phylogenetic information that can be split into different variable containing information about the different classes of the evolutionary history.\n\n### 3.1 Split data\n\nWe want to split the data in the \"lineage\" variable into multiple variables to store the information about each of the phylogenetic classes individually. First we investigate the data in the lineage variable:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenome_metadata |>\n  dplyr::select(Lineage) |>\n  dplyr::slice_sample(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 1\n   Lineage                                                                      \n   <chr>                                                                        \n 1 d__Bacteria;p__Bacillota;c__Bacilli;o__Lactobacillales;f__Lactobacillaceae;g…\n 2 d__Bacteria;p__Bacillota_C;c__Negativicutes;o__Veillonellales;f__Dialisterac…\n 3 d__Bacteria;p__Actinomycetota;c__Actinomycetia;o__Mycobacteriales;f__Mycobac…\n 4 d__Bacteria;p__Actinomycetota;c__Coriobacteriia;o__Coriobacteriales;f__Atopo…\n 5 d__Bacteria;p__Patescibacteria;c__Saccharimonadia;o__Saccharimonadales;f__Na…\n 6 d__Bacteria;p__Bacillota_A;c__Clostridia;o__Tissierellales;f__Peptoniphilace…\n 7 d__Bacteria;p__Bacillota_C;c__Negativicutes;o__Veillonellales;f__Dialisterac…\n 8 d__Bacteria;p__Actinomycetota;c__Coriobacteriia;o__Coriobacteriales;f__Atopo…\n 9 d__Bacteria;p__Actinomycetota;c__Actinomycetia;o__Actinomycetales;f__Bifidob…\n10 d__Bacteria;p__Bacillota_A;c__Clostridia;o__Saccharofermentanales;f__Fastidi…\n```\n\n\n:::\n:::\n\n\n\nBy investigating the data it is seen that each string of phylogenetic information consist of identifiers for each of the different classes in the taxonomic rank. These identifiers are:\n\n-   d = domain\n\n-   p = phylum\n\n-   c = class\n\n-   o = order\n\n-   f = family\n\n-   g = genus\n\n-   s = species\n\nWe want to start with converting all \"not provided\" to NA across all character columns. Then we want to split the \"lineage\" variable into its seven taxonomic ranks to store the information about each of the phylogenetic classes individually. Then we want to extract each taxonomic rank and remove prefixes. And convert empty strings to NA in the new taxonomy columns.\n\nWe then remove the GTDB suffixes (e.g. \"\\_A\") to streamline taxonomies. Lastly we remove columns that will not be used in our analysis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenome_metadata_clean <- genome_metadata |>\n  dplyr::mutate(\n    dplyr::across(\n      .cols = where(is.character),\n      .fns  = ~ dplyr::na_if(.x, \"not provided\")\n    )\n  ) |>\n  dplyr::mutate(\n    split_lineage = stringr::str_split_fixed(Lineage, \";\", 7),\n\n    Domain  = stringr::str_remove(split_lineage[, 1], \"d__\"),\n    Phylum  = stringr::str_remove(split_lineage[, 2], \"p__\"),\n    Class   = stringr::str_remove(split_lineage[, 3], \"c__\"),\n    Order   = stringr::str_remove(split_lineage[, 4], \"o__\"),\n    Family  = stringr::str_remove(split_lineage[, 5], \"f__\"),\n    Genus   = stringr::str_remove(split_lineage[, 6], \"g__\"),\n    Species = stringr::str_remove(split_lineage[, 7], \"s__\")\n  ) |>\n  dplyr::mutate(\n    dplyr::across(\n      .cols = c(Domain, Phylum, Class, Order, Family, Genus, Species),\n      .fns  = ~ dplyr::na_if(.x, \"\")\n    )\n  ) |>\n  dplyr::mutate(\n    dplyr::across(\n      .cols = Phylum:Species,\n      .fns  = ~ stringr::str_remove_all(as.character(.x), \"_[A-Za-z0-9]+\")\n    )\n  ) |>\n  dplyr::select(\n    -split_lineage,\n    -Genome_accession,\n    -Species_rep,\n    -Lineage,\n    -Sample_accession,\n    -Study_accession,\n    -FTP_download\n  )\n```\n:::\n\n\n\n### 3.2 Viewing the data\n\nViewing the top 10 rows of the split data to see the new structure.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenome_metadata_clean |> \n  dplyr::select(Genome, Domain:Species) |> \n  dplyr::slice_head(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 8\n   Genome        Domain   Phylum          Class       Order Family Genus Species\n   <chr>         <chr>    <chr>           <chr>       <chr> <chr>  <chr> <chr>  \n 1 MGYG000303700 Bacteria Patescibacteria Saccharimo… Sacc… Nanop… Nano… Nanope…\n 2 MGYG000303701 Bacteria Bacillota       Clostridia  Sacc… Fasti… KA00… KA0027…\n 3 MGYG000303702 Bacteria Bacillota       Bacilli     Stap… Gemel… Geme… Gemell…\n 4 MGYG000303703 Bacteria Bacillota       Clostridia  Sacc… Fasti… Mage… Mageei…\n 5 MGYG000303704 Bacteria Patescibacteria Saccharimo… Sacc… Nanop… Nano… Nanope…\n 6 MGYG000303705 Bacteria Bacteroidota    Bacteroidia Bact… Bacte… Prev… <NA>   \n 7 MGYG000303706 Bacteria Bacillota       Clostridia  Tiss… Pepto… Pept… Pepton…\n 8 MGYG000303707 Bacteria Bacillota       Bacilli     Lact… Lacto… Lact… Lactob…\n 9 MGYG000303708 Bacteria Bacillota       Clostridia  Sacc… Fasti… KA00… KA0027…\n10 MGYG000303709 Bacteria Patescibacteria Saccharimo… Sacc… Nanop… Nano… Nanope…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nview(genome_metadata_clean)\n```\n:::\n\n\n\n### 3.3 Saving the data\n\nSaving the cleaned data into 02_dat_clean.tsv file located in the data directory.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreadr::write_tsv(\n  x    = genome_metadata_clean,\n  file = \"../data/02_dat_clean.tsv\"\n)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
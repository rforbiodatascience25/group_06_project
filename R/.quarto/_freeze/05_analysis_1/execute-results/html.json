{
  "hash": "dbc1c4ece9367c6a1b5cec285670aaab",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"05_analysis_1\"\nformat: html\n---\n\n\n\n# Analysis 1 - Phylogenetic tree\n\nThe dataset contains information the different phylogenetic classes, which can be used to plot the phylogenetic tree.\n\n## 1. Load libraries\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"tidyverse\")\nlibrary(\"ggtree\")\nlibrary(\"ape\")\n```\n:::\n\n\n\n## 2. Load data\n\nLoading the data into a variable from the `03_dat_aug.tsv` file\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 618 Columns: 25\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (15): Genome, Genome_type, Country, Continent, Domain, Phylum, Class, Or...\ndbl (10): Length, N_contigs, N50, GC_content, Completeness, Contamination, r...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n\n## 3. Prepare data for plot\n\nFirst the different ranks in the phylogenetic are defined:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nranks <- c(\"Domain\", \"Phylum\", \"Class\", \"Order\", \"Family\", \"Genus\", \"Species\")\n```\n:::\n\n\n\nThen the observations containing NA values in all the variables related to the phylogenetic taxonomy ranks. The `drop_na` command is used, but it is specified which columns it should remove NA values from. If it was not specifed, then all NA observations would be removed and then observations having NA values in different variables would have been lost.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenome_phylo_data <- genome_metadata_aug |>\n    tidyr::drop_na(all_of(ranks))\n```\n:::\n\n\n\nThe data needs to be changed into factors as it is required for the .phylo command.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntax <- genome_phylo_data|>\n  dplyr::select(all_of(ranks)) |>         \n  dplyr::distinct() |>\n  dplyr::mutate(dplyr::across(everything(), as.factor))\n```\n:::\n\n\n\nUsing the as.phylo functions to translate the data into a tree. The hierachy of the data is defined in the function:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntree <- ape::as.phylo(~ Domain/Phylum/Class/Order/Family/Genus/Species, data = tax)\n```\n:::\n\n\n\n## 4. Plot of phylogenetic tree\n\nThen the specific tips of the tree of interest is defined to be able to color the tree by phylum:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntax_tip <- tax |>\n  dplyr::select(Species, Phylum) |>\n  dplyr::distinct() |>\n  dplyr::rename(label = Species)\n```\n:::\n\n\n\nThen the tip labels (the species) added to a list for each phylum:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphylum_list <- split(tax_tip$label, tax_tip$Phylum)\n```\n:::\n\n\n\nThen the information about each of the phylum groups are added to the tree using the groupOTU command:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntree_grp <- ggtree::groupOTU(.data = tree, .node = phylum_list)\n```\n:::\n\n\n\nTo plot the phylogenetic tree, the base plot is made:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- ggtree::ggtree(\ntr = tree_grp,\nlayout = \"circular\",\naes(color = factor(group)),\nsize = 0.4\n)\n```\n:::\n\n\n\nTo add the tax tips to the plot, the species and phylum is joined onto the tree data:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np$data <- p$data |>\n  dplyr::left_join(tax_tip, by = \"label\")\n```\n:::\n\n\n\nThe phylogenetic tree is then plotted and the edges of the plot is colored by the different phyla, to see the representation of the gene phyla present.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphylogenetic_tree_plot <- p +\n  ggtree::geom_tiplab(\n    aes(label = label),\n    size = 1.5,\n    offset = 0.05,\n    align = TRUE) +\n  ggplot2::scale_color_discrete(\n    name = \"Phylum\",\n    labels = names(phylum_list)) +\n  ggplot2::labs(\n    title = \"Phylogenetic tree colored by phylum\",\n    caption = \"Note: NA values were removed before constructing the tree\") +\n  ggtree::theme_tree() +\n  ggplot2::theme(\n    plot.title = ggplot2::element_text(hjust = 0.5, face = \"bold\"),\n    plot.caption = ggplot2::element_text(hjust = 0.5, size = 6, color = \"grey40\"),\n    legend.title = ggplot2::element_text(face = \"bold\"))\n\nphylogenetic_tree_plot\n```\n\n::: {.cell-output-display}\n![](05_analysis_1_files/figure-html/unnamed-chunk-12-1.svg){width=912}\n:::\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "05_analysis_1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
---
title: "Sigrid"
format: html
---

# Analysis GC content

GC content provides insight into both the biological identity and the technical characteristics of MAGs. Because GC content is shaped by long-term evolutionary history, different bacterial groups tend to exhibit characteristic GC signatures. This makes this feature useful for examining taxonomic structure within the dataset. At the same time, extreme GC values can influence sequencing performance and assembly quality, which means that GC content is also relevant when evaluating the reliability of MAGs.

In the following analyses, we investigate how GC content varies across phyla, how it relates to genome length, whether it affects assembly quality, and whether any genomes exhibit atypical GC profiles. Together, these analyses provide a deeper understanding of both the biological diversity and the assembly characteristics of the vaginal microbiome genome catalogue.

## Load libraries

```{r}
#| message: false
#| warning: false
library("tidyverse")
```

## Load data

```{r}
genome_metadata_aug <- readr::read_tsv("../data/03_dat_aug.tsv")
```

## 1. Compare GC content between taxa

GC content is often conserved within lineages and reflects long-term mutational biases, genome architecture, and ecological strategies. By comparing GC content across phyla represented in our dataset, we can evaluate whether the MAGs follow known biological patterns and identify potential outliers that has to be considering in further investigation.

**Known biological patterns: (need source)**

Across bacteria, GC content tends to be phylogenetically conserved, meaning that lineages often share similar GC levels due to long-term mutational and selective pressures.

Well-established trends include:

-   Actinomycetota – typically high GC (often \> 60%), linked to DNA repair systems and large, complex genomes.

-   Firmicutes (Bacillota) - generally low GC (around 30-45%).

-   Campylobacterota & Fusobacteriota - among the lowest GC phyla.

-   Proteobacteria (Pseudomonadota) - usually intermediate to moderately high GC but highly variable.

-   Bacteroidota - typically mid-range GC (40-50%).

-   Patescibacteria & Synergistota - often show intermediate but variable GC patterns, partly due to reduced genomes or niche-specific evolutionary pressures.

### 1.1 GC content distributions across phyla

GC content varies strongly between bacterial lineages due to long-term mutational and evolutionary processes. To examine whether the MAGs reflect known phylogenetic patterns, we visualise GC distributions across phyla.

```{r}
genome_metadata_aug |>
  ggplot(aes(x = Phylum,
             y = GC_content,
             fill = Phylum)) +
  geom_violin(trim  = FALSE,
              alpha = 0.5) +
  geom_boxplot(width       = 0.2,
               outlier.size = 0.5,
               alpha        = 0.8) +
  coord_flip() +
  scale_fill_brewer(palette = "Set3") +
  labs(
    x     = "Phylum",
    y     = "GC content (%)",
    title = "GC content distributions across phyla"
  ) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none")

```

Phyla show distinct GC signatures: Actinomycetota span the highest and widest GC range, Bacillota cluster at low GC, and Pseudomonadota fall in a mid–high range. These patterns reflect strong phylogenetic structuring of GC content and support correct taxonomic annotation in the dataset.

### 1.2 Summary statistics of GC content per phylum

To complement the visual patterns, we summarise GC content numerically for each phylum.

```{r}
genome_metadata_aug |>
  group_by(Phylum) |>
  summarise(
    n = n(),
    mean_GC = mean(GC_content, na.rm = TRUE),
    sd_GC   = sd(GC_content, na.rm = TRUE),
    min_GC  = min(GC_content, na.rm = TRUE),
    max_GC  = max(GC_content, na.rm = TRUE)
  )
```

The summary statistics confirm the visual differences, with Actinomycetota showing both the highest mean and greatest variability in GC content. Low-GC phyla such as Campylobacterota and Fusobacteriota display narrow ranges, indicating constrained mutational processes. Small phyla should be interpreted cautiously due to low sample sizes.

### 1.3 ANOVA: does GC differ significantly between phyla?

We use a one-way ANOVA to formally test whether mean GC content differs between phyla.

```{r}
gc_aov <- aov(GC_content ~ Phylum, data = genome_metadata_aug)
summary(gc_aov)

```

The ANOVA shows a highly significant effect of phylum on GC content, confirming that GC levels differ strongly between groups. This supports the conclusion that GC content is taxonomically structured rather than randomly distributed.

### 1.4 which phyla differ?

To determine which phyla differ significantly, we perform Tukey’s post-hoc comparison.

```{r}
TukeyHSD(gc_aov)

```

Most pairwise phylum comparisons differ significantly, especially contrasts involving Actinomycetota (high GC) and Fusobacteriota or Campylobacterota (low GC). Mid-range groups such as Bacteroidota show fewer strong contrasts. These results reinforce GC content as a robust phylogenetic marker.

## 2. Relationship between GC content and genome length (til præsentation)

### 2.1 Scatterplot: GC vs genome length

Next, we test whether genome size is associated with GC content, as some streamlined or host-adapted bacteria exhibit AT-rich genomes.

```{r}
genome_metadata_aug |>
  ggplot(aes(x = GC_content,
             y = Length,
             color = Phylum)) +
  geom_point(alpha = 0.6,
             size  = 1.8) +
  scale_y_log10() +
  scale_color_brewer(palette = "Dark2") +
  labs(
    x     = "GC content (%)",
    y     = "Genome length (bp, log scale)",
    title = "GC content vs genome length by phylum",
    color = "Phylum"
  ) +
  theme_minimal(base_size = 13)

```

Clear phylum-specific clusters appear, but genome length and GC content only correlate weakly overall. Large genomes occur across most GC levels, and small genomes are not restricted to low-GC taxa. This indicates that GC composition is only loosely linked to genome size.

### **2.2 Correlation between GC and genome length**

We compute the Pearson correlation to quantify the relationship between GC content and genome length.

```{r}
gc_len_cor <- genome_metadata_aug |>
  drop_na(GC_content, Length) |>
  summarise(
    cor_gc_length = cor(GC_content, Length)
  )

gc_len_cor

```

The correlation coefficient (0.32) indicates a weak positive association, explaining only a small fraction of the variance. Most of the visible structure is driven by phylogeny rather than a direct GC–size relationship.

## **3.** GC content and MAG quality

### 3.1 GC vs completeness

We investigate whether extreme GC content is associated with reduced MAG completeness.

```{r}
genome_metadata_aug |>
  ggplot(aes(x = GC_content,
             y = Completeness)) +
  geom_bin2d(bins = 30) +
  scale_fill_gradient(name = "Count") +
  labs(
    x     = "GC content (%)",
    y     = "Completeness (%)",
    title = "Density of MAGs by GC content and completeness"
  ) +
  theme_minimal(base_size = 13)

```

Completeness is uniformly high across all GC levels, with a dense cluster near 95–100%. This shows that GC extremes do not impair assembly completeness and that reconstruction quality is stable across the GC spectrum

### 3.2 GC vs contamination

We next assess whether very high or low GC content leads to higher contamination in MAGs.

```{r}
genome_metadata_aug |>
  ggplot(aes(x = GC_content,
             y = Contamination)) +
  geom_bin2d(bins = 30) +
  scale_fill_gradient(name = "Count") +
  labs(
    x     = "GC content (%)",
    y     = "Contamination (%)",
    title = "Density of MAGs by GC content and contamination"
  ) +
  theme_minimal(base_size = 13)
```

Contamination remains extremely low across all GC values, with most genomes near 0-1%. This suggests that GC content does not systematically bias binning quality or produce mixed assemblies.

### 3.3 Correlation of GC with quality metrics

To summarise these trends, we compute correlations between GC content and completeness/contamination.

```{r}
genome_metadata_aug |>
  drop_na(GC_content, Completeness, Contamination) |>
  summarise(
    cor_gc_completeness  = cor(GC_content, Completeness),
    cor_gc_contamination = cor(GC_content, Contamination)
  )

```

Both correlations are very small (\|r\| \< 0.2), confirming that GC content has no meaningful impact on MAG quality metrics.

## 4. GC-based outlier genomes within phyla (til præsentation)

### 4.1 Identify outliers relative to phylum-specific GC ranges

We identify genomes whose GC content lies outside the 5–95% phylum-specific range, flagging unusually high or low GC relative to their lineage.

```{r}
gc_outliers <- genome_metadata_aug |>
  group_by(Phylum) |>
  mutate(
    lower_gc = quantile(GC_content, 0.05, na.rm = TRUE),
    upper_gc = quantile(GC_content, 0.95, na.rm = TRUE),
    is_outlier = GC_content < lower_gc | GC_content > upper_gc
  ) |>
  filter(is_outlier) |>
  ungroup()

gc_outliers

```

This procedure identifies 67 GC outliers across all phyla. These genomes may represent taxonomic misassignments, unusual evolutionary adaptations, or assembly artefacts that merit deeper inspection.

We visualise how many GC outliers occur in each phylum.

```{r}
gc_outliers |>
  count(Phylum) |>
  ggplot(aes(x     = n,
             y     = fct_reorder(Phylum, n),
             color = Phylum)) +
  geom_point(size = 5) +
  scale_color_brewer(palette = "Dark2") +
  labs(
    x     = "Number of GC-outlier genomes",
    y     = "Phylum",
    title = "GC-content outliers per phylum"
  ) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none")

```

A small number of outliers are present across most phyla, with Actinomycetota and Bacillota contributing the largest counts simply due to their larger representation. No phylum shows disproportionate enrichment after accounting for size.

### 4.2 Observed vs expected outlier frequency per phylum

To determine whether any phylum has unusually many outliers, we compare observed counts with expected counts based on phylum size.

```{r}

phylum_totals <- genome_metadata_aug |> 
  count(Phylum, name = "total_genomes")


phylum_outliers <- gc_outliers |> 
  count(Phylum, name = "outlier_genomes")


expected_rate <- sum(phylum_outliers$outlier_genomes) / sum(phylum_totals$total_genomes)

phylum_outlier_analysis <- phylum_totals |>
  left_join(phylum_outliers, by = "Phylum") |>
  replace_na(list(outlier_genomes = 0)) |>
  mutate(
    expected_outliers = total_genomes * expected_rate,
    enrichment = outlier_genomes / expected_outliers
  )

phylum_outlier_analysis

```

Observed outlier counts closely match expectations for all major phyla, indicating no lineage-specific enrichment. Deviations in very small phyla are driven by low sample sizes rather than biological effects.

### 4.3 Outliers vs non-outliers: genome length comparison

We test whether outlier genomes differ in genome size compared with non-outliers.

```{r}
genome_metadata_aug |>
  mutate(is_outlier = Genome %in% gc_outliers$Genome) |>
  ggplot(aes(x = is_outlier, y = Length)) +
  geom_boxplot() +
  scale_y_log10() +
  labs(
    x = "GC outlier status",
    y = "Genome length (bp, log scale)",
    title = "Genome length of GC outliers vs non-outliers"
  )

```

Median genome lengths are similar between groups, with substantial overlap. This indicates that GC outliers do not reflect markedly larger or smaller genomes.

### 4.4 Outliers vs non-outliers: fragmentation

We also compare the number of contigs to assess whether GC outliers are more fragmented.

```{r}
genome_metadata_aug |>
  mutate(is_outlier = Genome %in% gc_outliers$Genome) |>
  ggplot(aes(x = is_outlier, y = N_contigs)) +
  geom_boxplot() +
  scale_y_log10() +
  labs(
    x = "GC outlier status",
    y = "Number of contigs (log scale)",
    title = "Assembly fragmentation in GC outliers vs non-outliers"
  )

```

Outliers show slightly higher contig counts on average, suggesting minor assembly challenges. However, the overlap between groups is large, and fragmentation alone does not explain the GC deviation.

### **4.5** High-GC vs low-GC outliers

We classify each outlier as high-GC or low-GC relative to its phylum median.

```{r}
gc_outliers |>
  mutate(type = ifelse(GC_content > median(GC_content), "High-GC outlier", "Low-GC outlier")) |>
  count(type)
```

Outliers split almost evenly into high-GC and low-GC categories, demonstrating that deviations occur symmetrically on both GC extremes.

### 4.6 Outlier deviation strength by phylum

Finally, we quantify how far each outlier deviates from its phylum’s expected GC range.

```{r}
gc_outliers |>
  mutate(
    deviation = case_when(
      GC_content < lower_gc ~ lower_gc - GC_content,
      GC_content > upper_gc ~ GC_content - upper_gc
    )
  ) |>
  ggplot(aes(x = deviation, y = Phylum, color = Phylum)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_color_brewer(palette = "Dark2") +
  labs(
    x = "GC deviation from expected range (%)",
    y = "Phylum",
    title = "Strength of GC-content deviation per outlier"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

```

Most outliers deviate only slightly (1–3%), but a small subset—mainly in Actinomycetota and Pseudomonadota—show large deviations (\>6%). These genomes are strong candidates for re-evaluation, as they may reflect true biological outliers or assembly/binnning issues.

## **5. Conclusion**

\
Across all genomic features examined, GC content, genome length, completeness, and contamination-endometriosis-associated genera do not differ meaningfully from non-associated genera. Their GC distributions overlap almost entirely, genome sizes fall within the same broad range, and assembly quality metrics show no systematic differences. These findings indicate that endometriosis association is not reflected in genome composition or MAG assembly characteristics. Instead, the relevance of these taxa to endometriosis is likely driven by ecological or community-level dynamics, such as shifts in abundance or changes in microbiome structure, rather than inherent genomic distinctions.

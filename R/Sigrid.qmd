---
title: "Sigrid"
format: html
---

# Analysis X - GC content

GC content provides insight into both the biological identity and the technical characteristics of MAGs. Because GC content is shaped by long-term evolutionary history, different bacterial groups tend to exhibit characteristic GC signatures. This makes this feature useful for examining taxonomic structure within the dataset. At the same time, extreme GC values can influence sequencing performance and assembly quality, which means that GC content is also relevant when evaluating the reliability of MAGs.

In the following analyses, we investigate how GC content varies across phyla, how it relates to genome length, whether it affects assembly quality, and whether any genomes exhibit atypical GC profiles. Together, these analyses provide a deeper understanding of both the biological diversity and the assembly characteristics of the vaginal microbiome genome catalogue.

## Load libraries

```{r}
#| message: false
#| warning: false
library("tidyverse")
```

## Load data

```{r}
genome_metadata_aug <- readr::read_tsv("../data/03_dat_aug.tsv")
```

## 1. Compare GC content between taxa

GC content is often conserved within lineages and reflects long-term mutational biases, genome architecture, and ecological strategies. By comparing GC content across phyla represented in our dataset, we can evaluate whether the MAGs follow known biological patterns and identify potential outliers that has to be considering in further investigation.

**Known biological patterns: (need source)**

Across bacteria, GC content tends to be phylogenetically conserved, meaning that lineages often share similar GC levels due to long-term mutational and selective pressures.

Well-established trends include:

-   Actinomycetota – typically high GC (often \> 60%), linked to DNA repair systems and large, complex genomes.

-   Firmicutes (Bacillota) - generally low GC (around 30-45%).

-   Campylobacterota & Fusobacteriota - among the lowest GC phyla.

-   Proteobacteria (Pseudomonadota) - usually intermediate to moderately high GC but highly variable.

-   Bacteroidota - typically mid-range GC (40-50%).

-   Patescibacteria & Synergistota - often show intermediate but variable GC patterns, partly due to reduced genomes or niche-specific evolutionary pressures.

### 1.1 GC content distributions across phyla (til præsentation)

We first compare GC content between phyla visually to see whether different groups occupy distinct GC ranges.

```{r}
genome_metadata_aug |>
  ggplot(aes(x = GC_content, y = Phylum)) +
  geom_boxplot() +
  labs(
    x = "GC content (%)",
    y = "Phylum",
    title = "GC content across phyla"
  )
```

The boxplot shows clear phylum-specific patterns in GC content, with Fusobacteriota and Campylobacterota forming the lowest-GC groups, Bacillota occupying a low-to-mid range, and Actinomycetota displaying both the highest and broadest GC values. Bacteroidota and Pseudomonadota fall within an intermediate to moderately high range. These distinct distributions indicate that GC content accurately reflects the underlying phylogenetic structure of the MAGs and that the dataset does not appear to contain major anomalies or misclassified genomes.

### 1.2 Summary statistics of GC content per phylum

Next, we summarise GC content numerically per phylum to quantify the central tendency and spread.

```{r}
genome_metadata_aug |>
  group_by(Phylum) |>
  summarise(
    n = n(),
    mean_GC = mean(GC_content, na.rm = TRUE),
    sd_GC   = sd(GC_content, na.rm = TRUE),
    min_GC  = min(GC_content, na.rm = TRUE),
    max_GC  = max(GC_content, na.rm = TRUE)
  )
```

The summary statistics support the visual patterns by showing that Actinomycetota have the highest mean GC content and the greatest variability, consistent with their known genomic diversity. Fusobacteriota and Campylobacterota exhibit both low mean values and narrow ranges, pointing to more constrained mutational processes. Bacteroidota and Pseudomonadota fall between these extremes with moderate means and moderate spread. Some phyla, such as Synergistota and Campylobacterota, include few genomes, so conclusions for them should be treated carefully. Overall, the results confirm substantial and consistent differences in GC content among phyla.

### 1.3 ANOVA: does GC differ significantly between phyla?

To formally test whether mean GC content differs between phyla, we use a one-way ANOVA.

```{r}
gc_aov <- aov(GC_content ~ Phylum, data = genome_metadata_aug)
summary(gc_aov)

```

The ANOVA reveals a highly significant effect of phylum on GC content, with an F-value of 75.49 and a p-value below 2 × 10⁻¹⁶. This demonstrates that average GC content varies strongly between phyla and that the differences observed in the plots and summaries are statistically robust. The result confirms that GC content is not randomly distributed across the dataset but follows clear taxonomic structure.

### 1.4 which phyla differ?

We use Tukey’s post-hoc test to see which specific phylum pairs differ in GC content.

```{r}
TukeyHSD(gc_aov)

```

The Tukey post-hoc test shows that most phyla differ significantly from one another, particularly in comparisons involving Actinomycetota, whose GC content is distinctly higher than most groups. Fusobacteriota also differ from nearly all other phyla due to their consistently low GC levels, and Campylobacterota show similar patterns relative to moderate- and high-GC groups. Bacillota differ significantly from both low- and high-GC phyla, reflecting their intermediate position. In contrast, comparisons involving Patescibacteria or Synergistota are often non-significant, either because their GC ranges overlap with other groups or because small sample sizes limit statistical resolution. Overall, the post-hoc test reveals a clear hierarchy of GC content, separating high-GC, mid-GC, and low-GC phyla and confirming GC content as a strong phylogenetic signal in this dataset.

## 2. Relationship between GC content and genome length (til præsentation)

### 2.1 Scatterplot: GC vs genome length

We now examine whether smaller genomes tend to be more AT-rich (lower GC), which is common in streamlined or host-adapted bacteria.

```{r}
genome_metadata_aug |>
  ggplot(aes(x = GC_content, y = Length)) +
  geom_point(alpha = 0.5) +
  labs(
    x = "GC content (%)",
    y = "Genome length (bp)",
    title = "GC content vs genome length"
  )

```

The scatterplot shows a wide spread of genome lengths across the full GC-content range, with no strong visual trend linking the two variables. Although very small genomes tend to occur at lower GC values, genomes of all sizes are found across most of the GC spectrum. This indicates that while some low-GC genomes may be associated with smaller, streamlined genomes, genome size overall is highly variable and does not consistently increase or decrease with GC content.

### **2.2 Correlation between GC and genome length**

We quantify the relationship between GC content and genome length using a Pearson correlation.

```{r}
gc_len_cor <- genome_metadata_aug |>
  drop_na(GC_content, Length) |>
  summarise(
    cor_gc_length = cor(GC_content, Length)
  )

gc_len_cor

```

The Pearson correlation coefficient of 0.32 indicates a weak positive relationship between GC content and genome length. This means that genomes with slightly higher GC tend to be somewhat larger, but the association is not strong and explains only a small portion of the variation. Most of the structure observed in the scatterplot is likely driven by phylum-specific patterns rather than by genome size itself. As a result, GC content and genome length appear only loosely linked in this dataset, and GC content alone is not a reliable predictor of genome size.

## **3.** GC content and MAG quality

### 3.1 GC vs completeness

We test whether genomes with extreme GC content tend to have lower completeness.

```{r}
genome_metadata_aug |>
  ggplot(aes(x = GC_content, y = Completeness)) +
  geom_point(alpha = 0.5) +
  labs(
    x = "GC content (%)",
    y = "Completeness (%)",
    title = "GC content vs completeness"
  )

```

The scatterplot shows that MAG completeness remains high across the entire GC-content range, with most genomes clustering close to 95–100% completeness regardless of whether their GC content is low or high. Although a few moderately complete genomes occur throughout the GC spectrum, there is no visible pattern suggesting that completeness systematically decreases at extreme GC values. This indicates that GC content does not meaningfully influence the completeness of genomes in this dataset.

### 3.2 GC vs contamination

Similarly, we check if contamination increases at very low or high GC values.

```{r}
genome_metadata_aug |>
  ggplot(aes(x = GC_content, y = Contamination)) +
  geom_point(alpha = 0.5) +
  labs(
    x = "GC content (%)",
    y = "Contamination (%)",
    title = "GC content vs contamination"
  )

```

The contamination plot similarly shows no strong relationship between GC content and contamination levels. Most genomes display very low contaminationoften across all GC ranges. While a few MAGs show slightly elevated contamination, these appear scattered without a clear trend toward either low-GC or high-GC genomes. Overall, contamination is largely independent of GC content, suggesting that GC extremes do not impair binning quality in a consistent way.

### 3.3 Correlation of GC with quality metrics

For a compact numeric summary, we calculate correlations between GC content and completeness/contamination.

```{r}
genome_metadata_aug |>
  drop_na(GC_content, Completeness, Contamination) |>
  summarise(
    cor_gc_completeness  = cor(GC_content, Completeness),
    cor_gc_contamination = cor(GC_content, Contamination)
  )

```

The correlation coefficients confirm the patterns seen in the scatterplots. GC content shows a very weak negative correlation with completeness (-0.08) and a weak positive correlation with contamination (0.19). Both values indicate that the relationships are extremely small and not biologically meaningful. These results support the conclusion that GC content does not systematically affect MAG quality in this dataset.

## 4. GC-based outlier genomes within phyla (til præsentation)

### 4.1 Identify outliers relative to phylum-specific GC ranges

In this analysis, the normal GC range for each phylum is defined directly from the MAGs in our dataset rather than from external reference genomes. For every phylum, we calculate the 5th and 95th percentiles of GC content, and this inner 90% interval is treated as the typical GC range for that group. Genomes with GC values below the 5th percentile or above the 95th percentile are therefore classified as outliers because their GC content is unusually low or high relative to other members of the same phylum in this dataset. Using this data-driven definition allows us to detect genomes that deviate markedly from the expected GC distribution of their group, which may indicate mis-binned or misassembled MAGs, or alternatively reflect genuinely unusual evolutionary or ecological characteristics.

The genomes flagged by this approach thus represent candidates for closer inspection in downstream analysis.

```{r}
gc_outliers <- genome_metadata_aug |>
  group_by(Phylum) |>
  mutate(
    lower_gc = quantile(GC_content, 0.05, na.rm = TRUE),
    upper_gc = quantile(GC_content, 0.95, na.rm = TRUE),
    is_outlier = GC_content < lower_gc | GC_content > upper_gc
  ) |>
  filter(is_outlier) |>
  ungroup()

gc_outliers

```

Although we identified 67 genomes with atypical GC content relative to their phylum, a detailed examination of each outlier is beyond the scope of this dataset, as it would require contig-level GC profiles, coverage information, and independent taxonomic validation tools such as GTDB-Tk or CheckM. In a full genomic analysis, these additional checks would allow us to determine whether each outlier reflects a misassembled or mis-binned genome, or whether it represents genuine biological variation. In this project, the outliers therefore serve primarily as indicators of MAGs that would merit closer investigation if deeper quality assessment resources were available.

Making a barplot for visualization:

```{r}
gc_outliers |>
  count(Phylum) |>
  ggplot(aes(x = fct_reorder(Phylum, n), 
             y = n, 
             fill = Phylum)) +
  geom_col() +
  coord_flip() +
  scale_fill_brewer(palette = "Set3") +
  labs(
    x = "Phylum",
    y = "Number of GC outlier genomes",
    title = "GC-content outlier genomes per phylum"
  ) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none")
```

---
title: "Exploring meta-data of human vaginal microbiome"
subtitle: "Group 6"
author:
  - Alberte Englund
  - Mathilde Due
  - Line Winther Gormsen
  - Sigrid Frandsen
  - Kristine Johansen
  
format: 
  revealjs:
    theme: moon
    self-contained: true
    code-line-numbers: true
    smaller: true
    scroll: true
    transition: slide
editor: visual
---

```{r}
library("tidyverse")
library("readr")
library("broom")
library("here")
library("ggrepel")
```

## STUDY DESCRIPTION

Meta-data from MGnify’s vaginal microbiome genome catalogue

-   Uncover patterns in genome quality, taxonomic composition, and ecological characteristics.

-   Identify potential patterns for diagnosis of endometriosis via associated pathogens of the vaginal microbiota based on genus:

    -   *Anaerococcus, Ureaplasma, Gardnerella, Veillonella, Corynebacterium, Peptoniphilus, Candida, Alloscardovia* [^1]

[^1]: MacSharry, J., Kovács, Z., Xie, Y. *et al.* Endometriosis specific vaginal microbiota links to urine and serum *N*-glycome. *Sci Rep* **14**, 25372 (2024). https://doi.org/10.1038/s41598-024-76125-2

## DATA CLEANING AND WRANGLING {.scrollable}

::::: {style="margin-top: -15px; margin-bottom: -15px;"}
**Untidy –\> tidy data**

:::: {style="margin-left: 1.5em; font-size: 0.9em; line-height: 1.1;"}
::: incremental
1.  *Split the data in the "lineage" variable into multiple variables of seven taxonomic ranks.*
2.  *Extract and mutate prefixes and GTDB suffixes (e.g. "\_A") to streamline taxonomies*
3.  *Each variable occupies a column, and each observation occupies a row.*
4.  *Mutate all "not provided" and empty strings to NA.*
5.  *Remove columns that will not be used in our analysis.*
6.  *Quality of the MAGs - completeness, contamination, and genome quality (high, medium, low) - joined to the left side of tidy data.*
7.  *Add column to MAGs dataset that flags each endometriosis-associated genus (True/False)*
:::
::::
:::::

::: panel-tabset
### Untidy datafile

```{r}
#| echo: true  
print(readr::read_tsv(here("data/_raw/genomes-all_metadata.tsv")))
```

### Lineages

```{r}
#| echo: true
untidy_data <- readr::read_tsv(
  here::here("data/_raw/genomes-all_metadata.tsv"))
  print(
    untidy_data  |>
    dplyr::select(Lineage))
```

### Tidy data

```{r}
#| echo: true   
print(readr::read_tsv(here("data/02_dat_clean.tsv")))
```

### Taxonomic ranks

```{r}
#| echo: true
tidy_data <- readr::read_tsv(
  here::here("data/02_dat_clean.tsv"))
  print(
    tidy_data  |>
    dplyr::select(Domain, Phylum, Class, Order, Family, Genus, Species))
```

### Augmentation

```{r}
#| echo: true
options(width = 200)
Aug_data <- readr::read_tsv(
  here::here("data/03_dat_aug.tsv"))
  print(
    Aug_data  |>
    dplyr::select(Completeness_quality, Contamination_quality, Overall_quality, endometriosis_associated),
    width = Inf)

```
:::

## DATA DESCRIPTION {.scrollable}

::: incremental
-   618 vaginal metagenome-assembled genomes (MAGs)
-   25 variables covering taxonomy, assembly quality, and geography
-   High completeness and low contamination for most genomes
-   Dataset dominated by a few major bacterial phyla
-   Genome lengths fall within biologically expected ranges
:::

. . .

::: panel-tabset
## Phylum distribution

Most MAGs belong to only a few dominant phyla.\
This indicates strong taxonomic skew in the dataset.

![](../results/04_key_plot_1.png){width="70%"}

------------------------------------------------------------------------

## Genome length distribution

Genome lengths fall within the expected biological range\
for vaginal bacterial taxa (typically 1.5–3 Mb).

![](../results/04_key_plot_3.png){width="70%"}

------------------------------------------------------------------------

## Geographic sample distribution

The majority of the data this study are from USA and China. This creates an uneven geographic distribution, which limits how confidently we can compare countries.

![](../results/04_key_plot_4.png){width="70%"}
:::

## ANALYSIS 1 - Phylogenetic tree {.scrollable}

::: incremental
-   Constructed a phylogenetic tree from the taxonomic ranks (*Domain → Species*) in the augmented dataset.
-   NA values in taxonomy were removed before tree construction.
-   The tree is colored by **phylum** to show taxonomic clustering.
:::

. . .

![](../results/05_key_plot_1.png){width="65%"}

## ANALYSIS 2 - Data quality {.scrollable}

Investigating the quality of samples.

. . .

::: incremental
-   Scatterplot of **completeness (%)** vs. **contamination (%)** for all MAGs
-   The dashed lines mark the **high-quality** genomes (above 90% completeness and below 5% contamination)
-   Points are colored by **phylum**
-   Most MAGs cluster in the high-quality area indicating good assemble quality of the MAGs.
:::

. . .

![](../results/06_key_plot_1.png){width="100%"}

## ANALYSIS 3 - Associated and non-associated-endometriosis MAGs {.scrollable}

::: incremental
-   Compared endometriosis-associated vs non-associated MAGs
-   Focused on GC content, genome length, completeness & contamination
-   Investigated whether associated MAGs cluster taxonomically
-   Goal: determine if associated MAGs form a genomically distinct group
:::

. . .

::: panel-tabset
## Phylum distribution

Endometriosis-associated MAGs occur in only a few phyla.\
Most phyla contain *no* associated MAGs, suggesting limited taxonomic clustering.

![](../results/07_key_plot_1.png){width="80%"}

------------------------------------------------------------------------

## GC content

GC content ranges overlap almost completely.\
No evidence that GC% distinguishes associated vs non-associated MAGs.

![](../results/07_key_plot_2.png){width="80%"}
:::

## ANALYSIS 4 - Taxa Distribution between countries {.scrollable}

::: incremental
-   Investigating the distribution of taxa in Countries
-   Filtered for NA in Countries
-   Counted taxa instances for each country and converted to wide format
-   Big difference in sample size --\> normalized data
:::

. . .

::: panel-tabset
## Heatmap

Variation between countries. I.e. Order Bacteroidales.

Not tested for significance.

 ![](../results/08_key_plot_2.png){width="87%"}

## Principal Component Analysis (PCA)

Only two principal components --\> 100% variance.

![](../results/08_key_plot_4.png){width="50%"}

Clear division of countries.

Along PC1, Fusobacteria and Bacteroidota (order = Bacteroidales). Correlation with heatmap.

![](../results/08_key_plot_5.png){width="90%"}

## Tests

Test to see if there is a significant difference in the proportion of endometriosis-associated genomes between countries

```{r}
#| echo: false 
all_fisher_results <- readr::read_tsv(here::here("results/08_key_table_1.tsv"))
knitr::kable(all_fisher_results, caption = "Fisher Exact Test Results")
```

-   Significant difference between USA and China
-   USA displayed 2.7 times higher odds of endometriosis-associated genomes
-   No significant difference between USA vs. Denmark or Denmark vs. China
-   Likely due to the limited amount of danish and chinese genomes represented
:::

## DISCUSSION & FUTURE PERSPECTIVES

-   High-quality MAGs with good completeness\

-   No strong genomic differences between groups\

-   Limited metadata and uneven sampling

-   Improve clinical + geographic metadata

-   More focus on theoretically correct analysis (compositional data analysis)

## CONCLUSION

-   The dataset contains high-quality MAGs with high completeness and low contamination

-   Taxonomy is dominated by a few phyla, with no distinct genomic patterns in endometriosis-associated bacterial groups

-   Sparse and uneven geographic metadata which limits ...
